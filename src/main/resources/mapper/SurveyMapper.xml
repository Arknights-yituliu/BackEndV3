<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lhs.mapper.SurveyMapper">


     <!--新增用户-->
    <insert id="insertSurveyUser">
        INSERT INTO `survey_user`
        (`id`, `user_name`, `create_time`, `update_time`, `ip`, `status`, `char_table`)
        VALUES (#{user.id}, #{user.userName}, #{user.createTime}, #{user.updateTime},
                #{user.ip}, #{user.status}, #{user.charTable})
    </insert>


    <!-- 查询用户根据用户名-->
    <select id="selectSurveyUserByUserName" resultType="com.lhs.entity.survey.SurveyUser">
        SELECT * FROM `survey_user` WHERE  `user_name` = #{userName}
    </select>

    <!-- 查询用户根据用户Ip-->
    <select id="selectLastSurveyUserIp" resultType="java.lang.Long">
        SELECT * FROM `survey_user` WHERE  `ip` = #{ip}
    </select>

    <!-- 查询用户根据id-->
    <select id="selectSurveyUserById" resultType="com.lhs.entity.survey.SurveyUser">
        SELECT * FROM `survey_user` WHERE  `id` = #{id}
    </select>

    <!-- 更新用户状态-->
    <update id="updateSurveyUser">
        UPDATE `survey_user`
        SET  `update_time` = #{user.updateTime}
        Where  `id` = #{user.id}
    </update>

    <!-- 查询用户表的id-->
    <select id="selectSurveyUserIds" resultType="java.lang.Long">
        SELECT `id`
        FROM survey_user
        WHERE  `status` = 1
    </select>

    <!-- 干员练度信息表，批量插入-->
    <insert id="insertBatchSurveyDataChar">
        INSERT INTO ${tableName}
        (`id`, `uid`, `char_id`, `phase`, `level`, `potential`, `rarity`, `skill1`, `skill2`, `skill3`, `mod_x`,
        `mod_y`,`own`)
        VALUES
        <foreach collection="surveyDataList" item="surveyData" separator=",">
            (#{surveyData.id}, #{surveyData.uid}, #{surveyData.charId}, #{surveyData.phase},
             #{surveyData.level},#{surveyData.potential}, #{surveyData.rarity}, #{surveyData.skill1},
             #{surveyData.skill2},#{surveyData.skill3},#{surveyData.modX},#{surveyData.modY},
             #{surveyData.own})
        </foreach>
    </insert>

    <!-- 干员练度信息表，根据id查询-->
    <select id="selectSurveyDataCharById" resultType="com.lhs.entity.survey.SurveyDataChar">
        SELECT *
        FROM ${tableName}
        WHERE id = #{id}
    </select>

    <!-- 干员练度信息表，根据id更新-->
    <update id="updateSurveyDataCharById">
        UPDATE ${tableName}
        SET `phase`     = #{surveyData.phase},
            `level`     = #{surveyData.level},
            `potential` = #{surveyData.potential},
            `skill1`    = #{surveyData.skill1},
            `skill2`    = #{surveyData.skill2},
            `skill3`    = #{surveyData.skill3},
            `mod_x`     = #{surveyData.modX},
            `mod_y`     = #{surveyData.modY},
            `own`       = #{surveyData.own}
        WHERE `id` = #{surveyData.id};
    </update>

    <!-- 干员练度信息表，根据多个uid查询-->
    <select id="selectSurveyDataCharVoByUidList" resultType="com.lhs.entity.survey.SurveyDataCharVo">
        SELECT `char_id`, `phase`, `level`,  `potential`, `rarity`, `skill1`, `skill2`, `skill3`, `mod_x`, `mod_y`,`own`
        FROM ${tableName}
        WHERE `uid` IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>

    <!-- 干员练度信息表，根据单个uid查询-->
    <select id="selectSurveyDataCharVoByUid" resultType="com.lhs.entity.survey.SurveyDataCharVo">
        SELECT `char_id`, `phase`, `level`,  `potential`, `rarity`, `skill1`, `skill2`, `skill3`, `mod_x`, `mod_y`,`own`
        FROM ${tableName}
        WHERE `uid` = #{uid}
    </select>

    <!-- 干员练度信息表，根据单个uid查询-->
    <select id="selectSurveyDataCharByUid" resultType="com.lhs.entity.survey.SurveyDataChar">
        SELECT *
        FROM ${tableName}
        WHERE `uid` = #{uid}
    </select>

    <!-- 干员练度信息表，根据单个uid查询-->
    <select id="deleteSurveyDataCharById" >
        SELECT *
        FROM ${tableName}
        WHERE `id` IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>



    <!--    干员练度统计表批量插入-->
    <insert id="insertBatchCharStatistics">
        INSERT INTO `survey_statistics_char`
        (`char_id`,`rarity`,`own`,`phase2`,`skill1`,`skill2`,`skill3`, `mod_x`, `mod_y`,`potential`)
        VALUES
        <foreach collection="surveyStatisticsList" item="surveyStatistics" separator=",">
            ( #{surveyStatistics.charId},#{surveyStatistics.rarity},#{surveyStatistics.own},
            #{surveyStatistics.phase2},#{surveyStatistics.skill1},#{surveyStatistics.skill2},
            #{surveyStatistics.skill3},#{surveyStatistics.modX},#{surveyStatistics.modY},
            #{surveyStatistics.potential})
        </foreach>
    </insert>


    <!--    干员练度统计表，清空表-->
    <delete id="truncateCharStatisticsTable">
        TRUNCATE TABLE `survey_statistics_char`
    </delete>

    <select id="selectCharStatisticsList" resultType="com.lhs.entity.survey.SurveyStatisticsChar">
        Select *
        FROM `survey_statistics_char`
    </select>




    <!--    调查表配置，根据key查询-->
    <select id="selectConfigByKey" resultType="java.lang.String">
        SELECT `config_value`
        FROM `survey_config`
        WHERE `config_key` = #{configKey}
    </select>

    <!--    调查表配置，根据key更新-->
    <update id="updateConfigByKey">
        UPDATE `survey_config`
        SET `config_value` = #{configValue}
        WHERE `config_key` = #{configKey};
    </update>

</mapper>
